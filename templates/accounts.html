<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>账号管理</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="#">OpenVPN CCD配置管理</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">首页</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="/accounts">账号管理</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/templates">模板管理</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logs">日志</a>
        </li>
      </ul>
    </div>
    <div class="navbar-nav">
                <span class="navbar-text me-3">
                    欢迎，{{.user}}
                </span>
      <a class="nav-link" href="/logout">退出登录</a>
    </div>
  </div>
</nav>

<div class="container mt-5">
  <h1 class="mb-4">账号管理</h1>

  <div class="d-flex justify-content-between mb-4">
    <h3>账号列表</h3>
    <a href="/account/add" class="btn btn-primary">添加账号</a>
  </div>

  <div class="card">
    <div class="card-body">
      <table class="table table-striped">
        <thead>
        <tr>
          <th>用户名</th>
          <th>中文名称</th>
          <th>账号类型</th>
          <th>状态</th>
          <th>关联模板</th>
          <th>关联IRoute账号</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {{range .accounts}}
        <tr>
          <td>{{.Username}}</td>
          <td>{{.DisplayName}}</td>
          <td>
            {{if .IsIRoute}}
            <span class="badge bg-info">IRoute账号</span>
            {{else}}
            <span class="badge bg-secondary">普通账号</span>
            {{end}}
          </td>
          <td>
            {{if .Enabled}}
            <span class="badge bg-success status-badge">启用</span>
            {{else}}
            <span class="badge bg-danger status-badge">禁用</span>
            {{end}}
          </td>
          <td>
            {{if .TemplateID}}
            {{.Template.Name}}
            {{else}}
            -
            {{end}}
          </td>
          <td>
            {{if not .IsIRoute}}
            {{range .IRoutes}}
            {{if .Account}}
            <span class="badge bg-primary">{{.Account.Username}}</span>
            {{end}}
            {{end}}
            {{else}}
            -
            {{end}}
          </td>
          <td>
            <a href="/account/edit/{{.Username}}" class="btn btn-sm btn-warning">编辑</a>
            <button class="btn btn-sm btn-danger" onclick="deleteAccount('{{.Username}}')">删除</button>
          </td>
        </tr>
        {{end}}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
  function deleteAccount(username) {
    if (confirm("确定要删除这个账号吗？删除后将无法恢复！")) {
      fetch(`/api/accounts/${username}`, {
        method: 'DELETE'
      })
              .then(response => response.json())
              .then(data => {
                if (data.message) {
                  alert(data.message);
                  location.reload();
                } else {
                  alert(data.error || "删除失败");
                }
              })
              .catch(error => {
                alert("删除失败: " + error.message);
              });
    }
  }
</script>
</body>
</html>